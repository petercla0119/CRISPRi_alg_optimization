# Purpose: Created to compare results obtained on my local machine to those from the JACKS publication. This was a sanity check to ensure scripts were running correctly and I could replicate the results on my computer.

# library(GGally)
library(dplyr)
library(ggplot2)
library(ggrepel)
setwd("~/Downloads")

# Functions ------------
## Function to compare two vectors without considering the order ----
compare_vectors <- function(vector1, vector2, save_as = NULL) {
  # Ensure the inputs are vectors
  if (!is.vector(vector1) | !is.vector(vector2)) {
    stop("Both inputs need to be vectors")
  }
  
  # Find values in vector1 not in vector2
  not_in_vector2 <- setdiff(vector1, vector2)
  
  # Find values in vector2 not in vector1
  not_in_vector1 <- setdiff(vector2, vector1)
  
  # Print out the values that don't match
  if (length(not_in_vector2) > 0) {
    cat("Values in vector1 not in vector2:\n")
    print(not_in_vector2)
  } else {
    cat("All values in vector1 are present in vector2\n")
  }
  
  if (length(not_in_vector1) > 0) {
    cat("Values in vector2 not in vector1:\n")
    print(not_in_vector1)
  } else {
    cat("All values in vector2 are present in vector1\n")
  }
  
  # Save the vectors as a user-defined variable if specified
  if (!is.null(save_as)) {
    assign(save_as, list(vector1 = vector1, vector2 = vector2), envir = .GlobalEnv)
    cat(paste("Vectors saved as", save_as, "in the global environment.\n"))
  }
}

## Function to create scatterplots for matching columns -------
create_scatterplots <- function(data, suffix1, suffix2) {
  # Get column names without suffixes
  column_names <- gsub(paste0("(", suffix1, "|", suffix2, ")$"), "", names(data))
  unique_column_names <- unique(column_names)
  
  # Loop through unique column names and create plots for matching columns
  for (col in unique_column_names) {
    col1 <- paste0(col, suffix1)
    col2 <- paste0(col, suffix2)
    
    # Check if both columns exist in the data
    if (col1 %in% names(data) & col2 %in% names(data)) {
      plot <- ggplot(data, aes_string(x = col1, y = col2, label = rownames(data))) +
        geom_point() +
        geom_text_repel() + # Add row names to the points
        labs(title = paste("Scatterplot of", col, "from Two Datasets"),
             x = paste(col, "from the paper"),
             y = paste(col, "from me")) +
        theme_minimal()
      print(plot)
    }
  }
}

# Import Avana dataset -------
paper_avana_gene_results <- read.table("/Users/Claire/Downloads/JACKS-master/jacks_2018_paper/JACKS_zipfile/avana_gene_JACKS_results.txt", sep = "\t", header = TRUE)
paper_avana_gene_pval_results <- read.table("/Users/Claire/Downloads/JACKS-master/jacks_2018_paper/JACKS_zipfile/avana_gene_pval_JACKS_results.txt", sep = "\t", header = TRUE)

my_avana_gene_results <- read.table("/Users/Claire/Downloads/JACKS-master/results/avana_jacks_results_gene_JACKS_results.txt", sep = "\t", header = TRUE)
my_avana_gene_pval_results <- read.table("/Users/Claire/Downloads/JACKS-master/results/avana_jacks_results_gene_pval_JACKS_results.txt", sep = "\t", header = TRUE)

# Combine datasets and add a label to identify them
paper_avana_gene_results$label <- 'paper'
my_avana_gene_results$label <- 'me'

combined_data <- rbind(paper_avana_gene_results, my_avana_gene_results)

# Merge the data from the paper with the data I generated by columns
avana_merged <- full_join(paper_avana_gene_results, my_avana_gene_results, by = "Gene", suffix = c("_paper", "_me"))

# Compare avana results files
my_avana_gene_val <- my_avana_gene_results$Gene
paper_avana_gene_val <- paper_avana_gene_results$Gene
# Compare avana gene results pval files
my_avana_pval <- my_avana_gene_pval_results$Gene
paper_avana_pval <- paper_avana_gene_pval_results$Gene

compare_vectors_no_order(my_avana_gene_val, paper_avana_gene_val)
compare_vectors_no_order(my_avana_pval, paper_avana_pval)

# Create scatterplots for matching columns
  ## DO NOT RUN on avana data - too many columns
# create_scatterplots(avana_merged, "_paper", "_me")


# Import Whitehead dataset -------
paper_whitehead_gene_results <- read.table("/Users/Claire/Downloads/JACKS-master/jacks_2018_paper/JACKS_zipfile/whitehead_gene_JACKS_results.txt", sep = "\t", header = TRUE)
paper_whitehead_gene_pval_results <- read.table("/Users/Claire/Downloads/JACKS-master/jacks_2018_paper/JACKS_zipfile/whitehead_gene_pval_JACKS_results.txt", sep = "\t", header = TRUE)

my_whitehead_gene_results <- read.table("/Users/Claire/Downloads/JACKS-master/results/jacks_whitehead_gene_JACKS_results.txt", sep = "\t", header = TRUE)
my_whitehead_gene_pval_results <- read.table("/Users/Claire/Downloads/JACKS-master/results/jacks_whitehead_gene_pval_JACKS_results.txt", sep = "\t", header = TRUE)

# Add new column, label, to specify which dataset
paper_whitehead_gene_results$label <- 'paper'
my_whitehead_gene_results$label <- 'me'

whitehead_combined <- rbind(paper_whitehead_gene_results, my_whitehead_gene_results)

# Merge the data from the paper with the data I generated by columns
whitehead_merged <- full_join(paper_whitehead_gene_results, my_whitehead_gene_results, by = "Gene", suffix = c("_paper", "_me"))

# Compare whitehead gene results files
my_whitehead_gene_val <- my_whitehead_gene_results$Gene
paper_whitehead_gene_val <- paper_whitehead_gene_results$Gene
# Compare whitehead gene results pval files
my_whitehead_pval <- my_whitehead_gene_pval_results$Gene
paper_whitehead_pval <- paper_whitehead_gene_pval_results$Gene

compare_vectors(my_whitehead_gene_val, paper_whitehead_gene_val)
compare_vectors(my_whitehead_pval, paper_whitehead_pval, save_as = "whitehead_pval")

# Create scatterplots for matching columns
create_scatterplots(whitehead_merged, "_paper", "_me")


create_scatterplots <- function(data, suffix1, suffix2) {
  # Get column names without suffixes
  column_names <- gsub(paste0("(", suffix1, "|", suffix2, ")$"), "", names(data))
  unique_column_names <- unique(column_names)
  
  # Ensure the data has row names
  if (is.null(rownames(data))) {
    rownames(data) <- 1:nrow(data)
  }
  
  # Loop through unique column names and create plots for matching columns
  for (col in unique_column_names) {
    col1 <- paste0(col, suffix1)
    col2 <- paste0(col, suffix2)
    
    # Check if both columns exist in the data
    if (col1 %in% names(data) & col2 %in% names(data)) {
      plot <- ggplot(data, aes_string(x = col1, y = col2)) +
        geom_point() +
        geom_text_repel(aes(label = rownames(data))) + # Add row names to the points
        labs(title = paste("Scatterplot of", col, "from Two Datasets"),
             x = paste(col, "from the paper"),
             y = paste(col, "from me")) +
        theme_minimal()
      print(plot)
    }
  }
}






# Check-in --------
# gene results files I generated match the values published in the 2018 paper
# i have 2000 fewer pvals from gene results of the whitehead dataset b/c the results i generated dont have "PSEUDO_GENE_#" rows 


# Import example data results 
example_github_results <- read.table("/Users/Claire/Downloads/JACKS-master/jacks_2018_paper/example_data/example_grna_JACKS_results.txt", sep = "\t", header = TRUE)
example_me_results <- read.table("/Users/Claire/Downloads/JACKS-master/jacks_test/results_example_jacks/example_jacks_grna_JACKS_results.txt", sep = "\t", header = TRUE)
test2_me_results <- read.table("/Users/Claire/Downloads/JACKS-master/jacks_2018_paper/jacks_test/test2_example_jacks/test2_grna_JACKS_results.txt", sep = "\t", header = TRUE)
# Create scatterplot
ggplot(example_github_results, aes(x = X1, y = X2, label=Gene)) +  # Specify x and y values
  geom_point() +                   # Add points to the plot
  labs(title = "Example_github results", # Add a title to the plot
       x = "X1",           # Label for the x-axis
       y = "X2") +         # Label for the y-axis
  theme_minimal()                   # Use a minimal theme for the plot

ggplot(example_me_results, aes(x = X1, y = X2)) +  # Specify x and y values
  geom_point() +                   # Add points to the plot
  labs(title = "Example_github results", # Add a title to the plot
       x = "X1",           # Label for the x-axis
       y = "X2") +         # Label for the y-axis
  theme_minimal()                   # Use a minimal theme for the plot
ggplot(test2_me_results, aes(x = X1, y = X2)) +  # Specify x and y values
  geom_point() +                   # Add points to the plot
  labs(title = "Example_github results", # Add a title to the plot
       x = "X1",           # Label for the x-axis
       y = "X2") +         # Label for the y-axis
  theme_minimal()                   # Use a minimal theme for the plot
# Misc. functions/tips -------------
# # Create scatterplot ----
# ggplot(combined_data, aes(x = x, y = y, color = label)) +
#   geom_point() +
#   labs(title = "Scatterplot Comparing Two Datasets",
#        x = "X-axis Label",
#        y = "Y-axis Label") +
#   theme_minimal()
# 
# ggpairs(combined_data, columns = 1:3, aes(color = label)) +
#   labs(title = "Pairwise Scatterplot Matrix Comparing Two Datasets") +
#   theme_minimal()